<!DOCTYPE html>
<html>
<head>
    <title>AJAX Activity | David Thong Nguyen</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body class="container">
<h1>AJAX Activity</h1>
<div class="container">
    <strong>Click to load malformed JSON file</strong><br>
    <button class="btn btn-danger" id="bad-json-btn"
            onclick="loadJson('data.json.txt', '#bad-json')">Malformed JSON
    </button>
    <div id="bad-json"></div>
    <hr>

    <strong>Click to load properly formed JSON file</strong><br>
    <button class="btn btn-success" id="good-json-btn"
            onclick="loadJson('data2.json.txt', '#good-json')">Properly formed JSON
    </button>
    <div id="good-json"></div>
    <hr>

    <strong>RSS feed</strong><br>
    <div id="rss-feed">
        Loading news...
    </div>
    <hr>

    <strong>Click to load random info generator</strong><br>
    <button class="btn" id="random-info-btn">Load</button>

    <div id="random-info"></div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6SpejstrongU02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script>
    function loadJson(url, selector, callback) {
        $.ajax({
            url: url,
            success: (result) => {
                try {
                    let parsedResult = JSON.parse(result);
                    $(selector).html(result);
                    callback()
                } catch (e) {
                    $(selector).innerText = '[ERROR] Error loading content';
                    alert('[ERROR] Error loading content');
                }
            },
            error: (err) => {
                $(selector).innerText = '[ERROR] Error loading content';
                alert('[ERROR] Error loading content')
            }
        });
    }

    function loadRss(url, selector){
        console.log("obj = " +obj);
        var items = obj.querySelectorAll("item");

        //show the logo
        var html = "";
        for (var i=0;i<items.length;i++){
            //get the data out of the item
            var newsItem = items[i];
            var title = newsItem.querySelector("title").firstChild.nodeValue;
            console.log(title);
            var description = newsItem.querySelector("description").firstChild.nodeValue;
            var link = newsItem.querySelector("link").firstChild.nodeValue;
            var pubDate = newsItem.querySelector("pubDate").firstChild.nodeValue;

            //present the item as HTML
            var line = '<div class="item">';
            line += "<h2>"+title+"</h2>";
            line += '<p><i>'+pubDate+'</i> - <a href="'+link+'" target="_blank">See original</a></p>';
            //title and description are always the same (for some reason) so I'm only including one
            //line += "<p>"+description+"</p>";
            line += "</div>";

            html += line;
        }
        $(selector).innerHTML = html;
    }

    $(document).ready(() => {
        $('#rss-feed').fadeOut(250);
        loadJson('http://www.espn.com/espn/rss/NHL/news', '', loadRss(#rss-feed));


    });
</script>
</body>

</html>